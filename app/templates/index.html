<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>VLM Image Captioning Service</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/index.css') }}">
</head>
<body>
<header>
    <h1>VLM Image Captioning Service</h1>
    <button id="reset-redis-btn" type="button">Reset Redis Cache</button>
    <div class="actions">
        <label for="model-select" class="small">Model:</label>
        <select id="model-select">
            <option value="blip">BLIP</option>
            <option value="blip2">BLIP2</option>
            <option value="gemma">Gemma</option>
            <option value="intern_vlm">Intern VLM</option>
        </select>
    </div>

    <div class="actions">
        <label for="mode-toggle" class="small">Collective mode</label>
        <label class="switch">
            <input type="checkbox" id="mode-toggle"/>
            <span class="slider"></span>
        </label>
        <span class="small" id="mode-hint">(multi-image â†’ one caption)</span>
        <span class="small" id="mode-warning">Only supported for Gemma and Intern VLM</span>
    </div>

    <div class="actions wrap">
        <label for="caption-prompt" class="small">Caption Prompt:</label>
        <textarea id="caption-prompt" placeholder="Enter optional caption prompt">{{ caption_prompt or '' }}</textarea>
    </div>

    <div class="actions wrap">
        <label for="flag-prompt" class="small">Flag Caption Prompt:</label>
        <textarea id="flag-prompt" placeholder="Enter optional flag prompt"
                  style="padding: 4px 8px; min-width: 280px; min-height: 80px; resize: vertical; border: 1px solid #ccc;">{{ flag_caption_prompt or '' }}</textarea>
    </div>

    <p class="small">Upload one or more images for captions. In collective mode, the server produces one caption for all
        images.</p>
</header>

<form id="upload-form">
    <input id="file-input" type="file" name="images" accept="image/*" multiple/>
    <div class="actions">
        <button id="submit-btn" type="submit">Caption Images</button>
        <span id="status" class="small"></span>
    </div>
</form>

<div id="previews"></div>
<div id="results"></div>

<script src="{{ url_for('static', path='js/index.js') }}"></script>
<script>
    window.DEFAULT_PROMPTS = {{ default_prompts | tojson }};
</script>
</body>
</html>
